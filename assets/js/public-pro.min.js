/*! WP Simple Pay Pro 3 - 3.3.6
 * https://wpsimplepay.com/
 * Copyright (c) Moonstone Media Group 2019
 * Licensed GPLv2+ */

var simpayAppPro={};!function(l){"use strict";var i;(simpayAppPro={init:function(){(i=l(document.body)).on("simpayBindCoreFormEventsAndTriggers",function(a,n,t){simpayAppPro.disableForm(n,t,!1),simpayAppPro.processCustomAmountInput(n,t),simpayAppPro.updateTotalAmountLabel(n,t),simpayAppPro.bindProFormEventsAndTriggers(n,t),simpayAppPro.handleFieldFocus(n),simpayAppPro.focusFirstField(),simpayAppPro.initDateField(n,t),simpayApp.isStripeCheckoutForm(t)?simpayAppPro.enableForm(n,t):simpayAppPro.setupStripeElementsForm(n,t)}),i.on("simpayFinalizeCoreAmount",simpayAppPro.setProFinalAmount)},setupStripeElementsForm:function(i,o){var a,t,e=i.find(".simpay-errors"),n=i.find(".simpay-card-wrap");function p(){var a=i.find(".simpay-billing-address-container"),n={name:i.find(".simpay-customer-name").first().val(),address_line1:a.find(".simpay-address-street").val(),address_city:a.find(".simpay-address-city").val(),address_state:a.find(".simpay-address-state").val(),address_zip:a.find(".simpay-address-zip").val(),address_country:a.find(".simpay-address-country").val()};o.isValid=!0,i.trigger("simpayBeforeStripePayment",[i,o]),o.isValid&&(simpayApp.setCoreFinalAmount(i,o),o.stripeParams.amount=spShared.convertToCents(o.finalAmount),i.find(".simpay-amount").val(o.stripeParams.amount),simpayAppPro.disableForm(i,o,!0),i.stripeInstance.createToken(t,n).then(function(a){var n,t;a.error?(e.html(a.error.message),simpayAppPro.enableForm(i,o)):(n=a.token,t=i.find(".simpay-email").first().val(),l("<input>").attr({type:"hidden",name:"simpay_stripe_token",value:n.id}).appendTo(i),l("<input>").attr({type:"hidden",name:"simpay_stripe_email",value:t}).appendTo(i),i.off("submit"),i.submit())}))}o.submitBtnClass="simpay-checkout-btn",i.stripeInstance=Stripe(o.stripeParams.key),a=i.stripeInstance.elements(),t=simpayAppPro.createCard(i,n,a),o.taxAmount=simpayAppPro.calculateTaxAmount(o.amount,o.taxPercent),o.couponCode="",n.length&&t.on("change",function(a){a.error?e.html(a.error.message):e.empty()}),t.on("ready",function(a){simpayAppPro.enableForm(i,o)}),i.on("submit",function(a){var n,t=!0;if(a.preventDefault(),i.find("input").each(function(a,n){!n.checkValidity||n.checkValidity()||(t=!1)}),!t)return(n=l("<input>").attr({type:"submit",style:"display: none"}).appendTo(i)).click(),void n.remove();p()})},isCustomAmountFieldValid:function(a,n){var t,i,o=a.find(".simpay-custom-amount-input"),e=a.find(".simpay-errors");return 0===o.length||(t=spShared.unformatCurrency(o.val()),i=n.isSubscription?spShared.unformatCurrency(n.subMinAmount):spShared.unformatCurrency(n.minAmount),-1<t&&i<=t?(e.empty(),o.removeClass("simpay-input-error"),!0):(n.isSubscription?e.html(n.subMinCustomAmountError):e.html(n.minCustomAmountError),o.addClass("simpay-input-error"),!1))},bindProFormEventsAndTriggers:function(n,t){var a=n.find(".simpay-custom-amount-input");a.on("blur.simpayCustomAmountInput",function(a){simpayAppPro.isCustomAmountFieldValid(n,t),simpayAppPro.processCustomAmountInput(n,t),simpayAppPro.updateTotalAmountLabel(n,t)}),a.on("focus.simpayCustomAmountInput",function(a){simpayAppPro.handleCustomAmountFocusIn(n,t)}),n.find(".simpay-apply-coupon").on("click.simpayApplyCoupon",function(a){a.preventDefault(),simpayAppPro.applyCoupon(n,t),simpayAppPro.updateTotalAmountLabel(n,t)}),n.find(".simpay-remove-coupon").on("click.simpayRemoveCoupon",function(a){a.preventDefault(),simpayAppPro.removeCoupon(n,t)}),n.find(".simpay-amount-dropdown, .simpay-amount-radio").on("change.simpayAmountSelect",function(a){simpayAppPro.updateAmountSelect(n,t)}),n.find(".simpay-quantity-dropdown, .simpay-quantity-radio").on("change.simpayQuantitySelect",function(){simpayAppPro.updateQuantitySelect(n,t)}),n.find(".simpay-quantity-input").on("keyup.simpayNumberQuantity, change.simpayNumberQuantity, input.simpayNumberQuantity",function(a){simpayAppPro.updateQuantitySelect(n,t),simpayAppPro.updateTotalAmountLabel(n,t)}),n.find(".simpay-multi-sub, .simpay-plan-wrapper select").on("change.simpayMultiPlan",function(a){simpayAppPro.changeMultiSubAmount(n,t)}),n.on("simpayCouponApplied simpayCouponRemoved",function(a){simpayAppPro.updateTotalAmountLabel(n,t)}),n.on("simpayDropdownAmountChange simpayDropdownAmountChange simpayRadioAmountChange simpayDropdownQuantityChange simpayRadioQuantityChange simpayNumberQuantityChange simpayMultiPlanChanged",function(a){void 0!==t.couponCode&&""!==t.couponCode.trim()||simpayAppPro.updateTotalAmountLabel(n,t)}),n.find(".simpay-same-address-toggle").on("change.simpaySameAddressToggle",function(a){simpayAppPro.toggleShippingAddressFields(n,t)}),n.on("simpayBeforeStripePayment",function(a,n,t){simpayAppPro.beforeSubmitPayment(n,t)}),n.find(".simpay-amount-dropdown, .simpay-amount-radio").trigger("change.simpayAmountSelect"),n.find(".simpay-quantity-dropdown, .simpay-quantity-radio").trigger("change.simpayQuantitySelect"),n.find(".simpay-multi-sub:checked, .simpay-plan-wrapper select:selected").trigger("change.simpayMultiPlan"),n.find(".simpay-quantity-input").trigger("input.simpayNumberQuantity"),i.trigger("simpayBindProFormEventsAndTriggers",[n,t])},handleFieldFocus:function(a){a.find(".simpay-form-control").each(function(a,n){var t=l(n);t.on("focusin",function(){t.addClass("is-focused")}),t.on("focusout",function(){setTimeout(function(){t.removeClass("is-focused"),t.val()?t.addClass("is-filled"):t.removeClass("is-filled")},300)})})},createCard:function(a,n,t){var i,o=n.data("hide-postal");return a.find(".simpay-address-zip").length&&(o=!0),(i=t.create("card",simpayAppPro.getCardConfig(o))).mount(n[0]),simpayAppPro.handleCardFocus(i,n),i},getCardConfig:function(a){return{hidePostalCode:a,style:{base:{color:"#32325d",fontFamily:"Roboto, Open Sans, Segoe UI, sans-serif",fontSize:"15px",fontSmoothing:"antialiased",fontWeight:500,"::placeholder":{color:"#aab7c4"}},invalid:{color:"#fa755a",iconColor:"#fa755a"}}}},handleCardFocus:function(a,n){a.on("focus",function(a){n.parents(".simpay-form-control").addClass("is-focused")}),a.on("blur",function(a){n.parents(".simpay-form-control").removeClass("is-focused")})},focusFirstField:function(){l(".simpay-modal-control").on("change",function(){var a=l(this).next(".simpay-modal").find("input").first();a.focus(),a.select(),a.parents(".simpay-form-control").addClass("is-focused")})},handleCustomAmountFocusIn:function(a,n){var t=a.find(".simpay-custom-plan-option"),i=a.find(".simpay-custom-amount-input");t.is("input")?t.prop("checked",!0):t.is("option")&&t.prop("selected",!0),n.useCustomPlan=!0,a.find(".simpay-has-custom-plan").val("true"),n.customPlanAmount=spShared.convertToCents(i.val())},beforeSubmitPayment:function(a,n){var t=a.find(".simpay-billing-address-container"),i=a.find(".simpay-shipping-address-container");simpayAppPro.processCustomAmountInput(a,n),simpayAppPro.isCustomAmountFieldValid(a,n)?(a.trigger("simpayFormValidationInitialized"),n.isTrial&&0===n.finalAmount?n.stripeParams.panelLabel=n.freeTrialButtonText:n.stripeParams.panelLabel=n.oldPanelLabel,a.find(".simpay-same-address-toggle").is(":checked")&&(i.find(".simpay-address-street").val(t.find(".simpay-address-street").val()),i.find(".simpay-address-city").val(t.find(".simpay-address-city").val()),i.find(".simpay-address-state").val(t.find(".simpay-address-state").val()),i.find(".simpay-address-zip").val(t.find(".simpay-address-zip").val()),i.find(".simpay-address-country").val(t.find(".simpay-address-country").val()),i.find(":disabled").removeProp("disabled"))):n.isValid=!1},initDateField:function(a,n){var t=a.find(".simpay-date-input");t.datepicker(),t.datepicker("option","dateFormat",n.dateFormat)},processCustomAmountInput:function(a,n){var t,i=a.find(".simpay-custom-amount-input");0!==i.length&&(t=i.val(),n.isSubscription?(n.customAmount=spShared.unformatCurrency(""!==t?t:n.subMinAmount),n.planAmount=n.customAmount,n.customPlanAmount=n.planAmount):n.customAmount=spShared.unformatCurrency(""!==t?t:n.minAmount),simpayAppPro.applyCoupon(a,n))},setProFinalAmount:function(a,n,t){var i=t.amount;void 0!==t.customAmount&&0<t.customAmount&&(i=t.customAmount),void 0!==t.isSubscription&&t.isSubscription&&("single"===t.subscriptionType?(i=void 0!==t.customPlanAmount?t.customPlanAmount:t.amount,t.planAmount=i):i=void 0!==t.useCustomPlan&&t.useCustomPlan?t.customPlanAmount:t.planAmount,t.isTrial&&(i=0),void 0!==t.setupFee&&(i+=t.setupFee),void 0!==t.planSetupFee&&(i+=spShared.unformatCurrency(t.planSetupFee))),void 0!==t.quantity&&(i*=t.quantity),void 0!==t.discount&&(i-=t.discount),void 0===t.isSubscription||t.isSubscription||(0<t.feePercent&&(i+=i*(t.feePercent/100)),0<t.feeAmount&&(i+=t.feeAmount)),0<t.taxPercent&&(t.taxAmount=simpayAppPro.calculateTaxAmount(i,t.taxPercent),i+=t.taxAmount,n.find(".simpay-tax-amount").val(t.taxAmount)),t.finalAmount=i},applyCoupon:function(n,t){var a,i=n.find(".simpay-coupon-field"),o=n.find(".simpay-coupon-message"),e=n.find(".simpay-coupon-loading"),p=n.find(".simpay-remove-coupon"),s=n.find(".simpay-coupon"),u="",r="",m=t.amount,d=0;if(i.val())u=i.val();else{if(!t.couponCode)return;u=t.couponCode}t.isSubscription?(void 0!==t.setupFee?d=t.setupFee:void 0!==t.planSetupFee&&(d=spShared.unformatCurrency(t.planSetupFee)),m=t.useCustomPlan?t.customPlanAmount+d:t.planAmount+d):"undefined"!==t.customAmount&&0<t.customAmount&&(m=t.customAmount),void 0!==t.quantity&&(m*=t.quantity),a={action:"simpay_get_coupon",coupon:u,amount:m,couponNonce:n.find("#simpay_coupon_nonce").val()},o.text(""),p.hide(),i.val(""),e.show(),l.ajax({url:spGeneral.strings.ajaxurl,method:"POST",data:a,dataType:"json",success:function(a){t.couponCode=u,t.discount=a.discount,r=a.coupon.code+": ","percent"===a.coupon.type?r+=a.coupon.amountOff+spGeneral.i18n.couponPercentOffText:"amount"===a.coupon.type&&(r+=spShared.formatCurrency(a.coupon.amountOff,!0)+" "+spGeneral.i18n.couponAmountOffText),l(".coupon-details").remove(),o.append(r),l("<input />",{name:"simpay_coupon_details",type:"hidden",value:r,class:"simpay-coupon-details"}).appendTo(o),p.show(),s.val(u),e.hide(),n.trigger("simpayCouponApplied")},error:function(a){var n="";spShared.debugLog("Coupon error",a.responseText),a.responseText&&(n=a.responseText),o.append(l("<p />").addClass("simpay-field-error").text(n)),e.hide()}})},removeCoupon:function(a,n){a.find(".simpay-coupon-loading").hide(),a.find(".simpay-remove-coupon").hide(),a.find(".simpay-coupon-message").text(""),a.find(".simpay-coupon").val(""),n.couponCode="",n.discount=0,a.trigger("simpayCouponRemoved")},updateAmountSelect:function(a,n){a.find(".simpay-amount-dropdown").length?(n.amount=a.find(".simpay-amount-dropdown").find("option:selected").data("amount"),a.trigger("simpayDropdownAmountChange")):a.find(".simpay-amount-radio")&&(n.amount=a.find(".simpay-amount-radio").find('input[type="radio"]:checked').data("amount"),a.trigger("simpayRadioAmountChange")),simpayAppPro.applyCoupon(a,n)},updateQuantitySelect:function(a,n){n.quantity=1,a.find(".simpay-quantity-dropdown").length?(n.quantity=parseFloat(a.find(".simpay-quantity-dropdown").find("option:selected").data("quantity")),a.trigger("simpayDropdownQuantityChange")):a.find(".simpay-quantity-radio").length?(n.quantity=parseFloat(a.find(".simpay-quantity-radio").find('input[type="radio"]:checked').data("quantity")),a.trigger("simpayRadioQuantityChange")):a.find(".simpay-quantity-input").length&&(n.quantity=parseFloat(a.find(".simpay-quantity-input").val()),a.trigger("simpayNumberQuantityChange")),n.quantity<1&&(n.quantity=1),a.find(".simpay-quantity").val(n.quantity),simpayAppPro.applyCoupon(a,n)},updateTotalAmountLabel:function(a,n){var t;simpayApp.setCoreFinalAmount(a,n),t=spShared.formatCurrency(n.finalAmount,!0),a.find(".simpay-total-amount-value").text(t),simpayAppPro.updateRecurringAmountLabel(a,n),simpayAppPro.updateTaxAmountLabel(a,n)},updateRecurringAmountLabel:function(a,n){var t=n.planAmount*n.quantity,i=t+simpayAppPro.calculateTaxAmount(t,n.taxPercent),o=spShared.formatCurrency(i,!0);1<n.planIntervalCount?o+=" every "+n.planIntervalCount+" "+n.planInterval+"s":o+="/"+n.planInterval,a.find(".simpay-total-amount-recurring-value").text(o)},updateTaxAmountLabel:function(a,n){a.find(".simpay-tax-amount-value").text(spShared.formatCurrency(n.taxAmount,!0))},calculateTaxAmount:function(a,n){return Math.abs(accounting.toFixed(a*(n/100),spGeneral.integers.decimalPlaces))},changeMultiSubAmount:function(a,n){var t,i,o,e,p,s,u,r="",m=a.find(".simpay-errors"),d=a.find(".simpay-custom-amount-input"),l=a.find(".simpay-plan-wrapper").find(".simpay-multi-sub");t=(r=l.first().is("option")?l.filter(":selected"):l.filter(":checked")).data("plan-id")||"",i=r.data("plan-setup-fee")||0,o=r.data("plan-amount")||0,e=r.data("plan-interval")||"",p=r.data("plan-interval-count")||1,s=void 0!==r.data("plan-trial"),u=r.data("plan-max-charges")||0,s&&(n.amount=0),n.planId=t,n.planSetupFee=i,n.planAmount=o,n.planInterval=e,n.planIntervalCount=p,n.isTrial=s,r.hasClass("simpay-custom-plan-option")?a.find(".simpay-has-custom-plan").val("true"):a.find(".simpay-has-custom-plan").val(""),m.empty(),d.removeClass("simpay-input-error"),n.useCustomPlan="simpay_custom_plan"===r.val(),n.useCustomPlan?(d.val(""),d.focus()):d.val(spShared.formatCurrency(o)),a.find(".simpay-multi-plan-id").val(t),a.find(".simpay-multi-plan-setup-fee").val(i),a.find(".simpay-max-charges").val(u),a.trigger("simpayMultiPlanChanged"),simpayAppPro.applyCoupon(a,n)},toggleShippingAddressFields:function(a,n){var t=a.find(".simpay-shipping-address-container");a.find(".simpay-same-address-toggle").is(":checked")?t.hide().find(":enabled").prop("disabled",!0):t.show().find(":disabled").removeProp("disabled")},disableForm:function(a,n,t){var i=a.find(".simpay-checkout-btn");i.prop("disabled",!0),!0===t&&i.addClass("simpay-disabled").find("span").text(n.loadingText)},enableForm:function(a,n){var t=a.find(".simpay-checkout-btn");t.removeProp("disabled").removeClass("simpay-disabled"),n.loadingText==t.find("span").text()&&t.find("span").text(n.checkoutButtonText),a.find(":disabled").removeProp("disabled")}}).init()}(jQuery);